<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Predicción y Preguntas Frecuentes - ESFOT IA</title>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background-color: #f7f9fc;
      margin: 0;
      padding: 0;
      color: #333;
    }
    header {
      background-color: #004080;
      color: white;
      padding: 1.5rem 1rem;
      text-align: center;
      box-shadow: 0 2px 6px rgba(0,0,0,0.15);
      position: relative;
    }
    header h1 {
      margin: 0;
      font-size: 1.8rem;
    }
    #btnVolver {
      position: absolute;
      left: 1rem;
      top: 1.5rem;
      background-color: white;
      color: #004080;
      border: none;
      padding: 0.4rem 0.8rem;
      font-weight: bold;
      border-radius: 6px;
      cursor: pointer;
      transition: background-color 0.3s ease;
    }
    #btnVolver:hover {
      background-color: #d0e6ff;
    }
    main {
      max-width: 900px;
      margin: 2rem auto;
      background-color: white;
      border-radius: 12px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.1);
      padding: 2rem 2.5rem;
    }
    h2 {
      color: #004080;
      margin-bottom: 1rem;
      border-bottom: 2px solid #004080;
      padding-bottom: 0.3rem;
    }
    label {
      display: block;
      margin-top: 1rem;
      font-weight: 600;
    }
    select, input[type="text"], textarea {
      width: 100%;
      padding: 0.6rem 0.8rem;
      margin-top: 0.4rem;
      border: 1.5px solid #ccc;
      border-radius: 6px;
      font-size: 1rem;
      transition: border-color 0.3s;
    }
    select:focus, input[type="text"]:focus, textarea:focus {
      outline: none;
      border-color: #004080;
      box-shadow: 0 0 6px rgba(0, 64, 128, 0.3);
    }
    textarea {
      resize: vertical;
      min-height: 100px;
    }
    button {
      background-color: #004080;
      color: white;
      border: none;
      border-radius: 8px;
      padding: 0.8rem 1.2rem;
      margin-top: 1.5rem;
      font-size: 1.1rem;
      cursor: pointer;
      font-weight: 600;
      transition: background-color 0.3s ease;
    }
    button:hover {
      background-color: #0066cc;
    }
    .respuesta, .resultado {
      margin-top: 1.5rem;
      padding: 1rem 1.2rem;
      border-left: 5px solid #004080;
      background-color: #e7f0ff;
      border-radius: 6px;
      font-size: 1rem;
      white-space: pre-wrap;
    }
    /* Responsive */
    @media (max-width: 600px) {
      main {
        padding: 1.5rem 1.2rem;
      }
      #btnVolver {
        position: static;
        display: block;
        margin-bottom: 1rem;
      }
    }
  </style>
</head>
<body>
  <header>
    <button onclick="location.href='./index.html'" id="btnVolver" aria-label="Volver a página principal">Volver</button>
    <h1>Predicción y Preguntas Frecuentes - ESFOT IA</h1>
  </header>

  <main>
    <section aria-label="Consulta preguntas frecuentes">
      <h2>Consulta Preguntas Frecuentes</h2>
      <label for="preguntasSelect">Selecciona una pregunta frecuente:</label>
      <select id="preguntasSelect" aria-describedby="preguntasHelp">
        <option value="">-- Selecciona una pregunta --</option>
        <option>¿Cuántas horas necesito de prácticas laborales?</option>
        <option>¿Cuáles son los requisitos para convalidar prácticas?</option>
        <option>¿Dónde puedo hacer vinculación?</option>
        <option>¿Qué hago si ya tengo tutor para mis prácticas?</option>
        <option>¿Puedo hacer prácticas con familiares?</option>
        <option>¿Qué documentos debo enviar para el registro de prácticas?</option>
        <option>¿Cuánto tiempo de validez tienen los certificados de prácticas?</option>
      </select>
      <button type="button" id="btnConsultar">Consultar</button>
      <div id="respuesta" class="respuesta" role="alert" aria-live="polite"></div>
    </section>

    <hr style="margin: 3rem 0; border: none; border-top: 1px solid #ccc;">

    <section aria-label="Formulario para predicción de modalidad">
      <h2>Analizador de Actividad</h2>
      <p>Ingresa el tipo y descripción detallada de la actividad que planeas realizar para que el sistema prediga si es <strong>Práctica Preprofesional (PPP)</strong> o <strong>Convalidación</strong>.</p>

      <form id="formulario" autocomplete="off" novalidate>
        <label for="tipo_actividad">Tipo de actividad:</label>
        <input type="text" id="tipo_actividad" name="tipo_actividad" placeholder="Ej. Pasantía, Proyecto externo, etc." required />

        <label for="descripcion">Descripción detallada de la actividad:</label>
        <textarea id="descripcion" name="descripcion" placeholder="Ej. Realizaré actividades de desarrollo web en una empresa privada por 3 meses..." required></textarea>

        <button type="submit">Predecir Modalidad</button>
      </form>

      <div id="resultado" class="resultado" role="alert" aria-live="polite"></div>
    </section>
  </main>

  <script>
    const BACKEND_URL = "https://prediccionia-production.up.railway.app";

    // Botón Volver
    document.getElementById('btnVolver').addEventListener('click', () => {
      window.location.href = "/Frontend/public/index.html"; // Cambia aquí la URL deseada
    });

    // Consultar pregunta frecuente
    document.getElementById('btnConsultar').addEventListener('click', async () => {
      const select = document.getElementById('preguntasSelect');
      const pregunta = select.value;
      const respuestaDiv = document.getElementById('respuesta');
      respuestaDiv.textContent = "";

      if (!pregunta) {
        respuestaDiv.textContent = "Por favor, selecciona una pregunta.";
        return;
      }

      try {
        const res = await fetch(`${BACKEND_URL}/formulario/pregunta`, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ texto: pregunta })
        });
        const data = await res.json();
        respuestaDiv.textContent = data.respuesta || "No hay respuesta disponible.";
      } catch (error) {
        respuestaDiv.textContent = "Error al conectar con el servidor.";
      }
    });

    // Formulario de predicción
    document.getElementById("formulario").addEventListener("submit", async (e) => {
      e.preventDefault();
      const form = e.target;
      const out = document.getElementById("resultado");
      out.textContent = "";

      if (!form.checkValidity()) {
        out.textContent = "Por favor, completa todos los campos correctamente.";
        return;
      }

      const formData = new FormData(form);
      const data = Object.fromEntries(formData.entries());

      try {
        const res = await fetch(`${BACKEND_URL}/formulario/registro`, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(data)
        });
        const result = await res.json();

        out.innerHTML = `
          <strong>Resultado de la Predicción:</strong><br><br>
          La actividad fue clasificada como: 
          <span style="font-weight:bold; color:#004080;">${result.data.modalidad_predicha ?? 'Desconocido'}</span><br><br>
          <strong>Descripción:</strong><br>
          ${result.data.descripcion ?? data.descripcion}
        `;

        form.reset();
      } catch (error) {
        out.textContent = "Error al enviar el formulario o conectar con el servidor.";
      }
    });
  </script>
</body>
</html>
